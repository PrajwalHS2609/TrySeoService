<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta
      name="google-site-verification"
      content="FWwxRSWdpG_SfI8-B-tFo1rG19PEXzw3QdeDSlQF2aA"
    />

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-6YB819D36Q"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-6YB819D36Q");
    </script>

    <!-- 🌍 Country-based redirect script -->
    <script>
      (async function () {
        // Skip redirect in local development
        if (window.location.hostname === "localhost") return;

        const params = new URLSearchParams(window.location.search);
        const mockCountry = params.get("country")?.toUpperCase();

        try {
          const res = await fetch("https://ipapi.co/json/");
          const data = await res.json();

          let countryCode = mockCountry || data.country_code;

          // Normalize GB → UK
          if (countryCode === "GB") countryCode = "UK";

          // Allowed and mapped countries
          const redirectMap = {
            IN: "/in",
            US: "/us",
            CA: "/ca",
            UK: "/uk",
            AU: "/au",
            DE: "/de",
            FR: "/fr",
            AE: "/ae",
            SA: "/sa",
            IT: "it",
            NL: "nl",
            MY: "my",
            QA: "qa",
            PL: "pl",
          };

          // Store the visitor's preferred country
          localStorage.setItem("preferredCountry", countryCode);

          const targetPrefix = redirectMap[countryCode];
          const fallbackPrefix = "/"; // default if detection fails

          const currentPath = window.location.pathname;
          const pathSegments = currentPath.split("/").filter(Boolean);
          const firstSegment = pathSegments[0]?.toLowerCase();

          // Check if already has country code (like /in or /de)
          const hasCountryPrefix = Object.values(redirectMap)
            .map((p) => p.replace("/", "").toLowerCase())
            .includes(firstSegment);

          // 🚀 If no country prefix → redirect with detected one
          if (!hasCountryPrefix) {
            const prefix = targetPrefix || fallbackPrefix;
            const newUrl = prefix + currentPath;
            window.location.replace(newUrl);
          }
        } catch (err) {
          console.error("Geo redirect failed:", err);
        }
      })();
    </script>

    <link rel="icon" href="/faviconPerfect.png" />
    <title>TrySeoService</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
